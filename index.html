<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voievox SRT ジェネレーター</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="top-bar">
      <div class="top-bar__text">
        <h1 class="top-bar__title">SRT字幕自動生成</h1>
        <p class="lead">音声とテキストのペアから、すぐに字幕を生成してダウンロードできます。</p>
      </div>
      <button
        id="openSettingsButton"
        class="icon-button"
        type="button"
        aria-haspopup="dialog"
        aria-controls="settingsPanel"
        aria-expanded="false"
      >
        <span class="sr-only">詳細設定を開く</span>
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path
            d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm8.94-2.85-.78-1.35a1 1 0 0 1 .21-1.2l1.1-1.05a1 1 0 0 0 .08-1.32l-1.7-2.35a1 1 0 0 0-1.28-.3l-1.4.68a1 1 0 0 1-1.24-.3l-.88-1.2a1 1 0 0 0-1.14-.38l-2.8.9a1 1 0 0 0-.68.95l.06 1.63a1 1 0 0 1-.62.94l-1.5.58a1 1 0 0 0-.63 1.08l.45 2.82a1 1 0 0 0 1.02.83l1.57-.05a1 1 0 0 1 .97.65l.55 1.48a1 1 0 0 0 1.06.64l2.8-.39a1 1 0 0 0 .85-.93l.12-1.57a1 1 0 0 1 .83-.9l1.53-.3a1 1 0 0 0 .76-1.47Z"
          />
        </svg>
      </button>
    </header>

    <main class="main">
      <form id="settingsForm" class="primary-form">
        <section class="primary-card">
          <div class="field">
            <label class="field-label" for="openPickerButton">ファイルを選択</label>
            <div class="file-input">
              <button type="button" id="openPickerButton" class="button button-secondary">ブラウズ…</button>
              <p class="hint">同名の <code>.wav</code> と <code>.txt</code> をペアにして処理します。</p>
            </div>
            <input id="folderInput" type="file" webkitdirectory directory multiple hidden />
            <input id="fileInput" type="file" multiple accept=".wav,.txt" hidden />
          </div>

          <div id="selectedFiles" class="selected-files empty" aria-live="polite">
            ファイルが選択されていません
          </div>

          <div class="field">
            <label class="field-label" for="frameRate">フレームレート (fps)</label>
            <div class="frame-rate-control">
              <input
                type="number"
                id="frameRate"
                name="frameRate"
                step="0.001"
                min="1"
                max="240"
                value="30"
              />
              <div class="frame-rate-presets" id="frameRatePresets" role="radiogroup" aria-label="フレームレートプリセット">
                <button type="button" class="chip" data-frame-rate="23.976">23.976</button>
                <button type="button" class="chip" data-frame-rate="24">24</button>
                <button type="button" class="chip active" data-frame-rate="30">30</button>
                <button type="button" class="chip" data-frame-rate="60">60</button>
                <button type="button" class="chip" data-frame-rate="custom">カスタム</button>
              </div>
            </div>
            <p class="hint">タイムラインのフレームレートを入力するか、プリセットを選択してください。</p>
          </div>

          <div class="primary-actions">
            <button type="submit" class="button button-primary">SRTを生成</button>
            <a id="downloadLink" class="button button-ghost" download="output.srt" aria-disabled="true">ダウンロード</a>
          </div>
        </section>

        <section class="card results" id="results" hidden>
          <header class="results__header">
            <h2>結果</h2>
            <p class="hint">生成内容とログはブラウザ内でのみ保持されます。</p>
          </header>
          <div class="result-grid">
            <div>
              <dl class="stats">
                <div>
                  <dt>クリップ数</dt>
                  <dd id="clipCount">0</dd>
                </div>
                <div>
                  <dt>元の合計時間</dt>
                  <dd id="originalTotal">0.00 秒</dd>
                </div>
                <div>
                  <dt>適用調整値</dt>
                  <dd id="adjustment">0.0000 秒</dd>
                </div>
                <div class="auto-only">
                  <dt>目標合計時間</dt>
                  <dd id="targetTotal">-</dd>
                </div>
                <div class="frame-only">
                  <dt>使用フレームレート</dt>
                  <dd id="frameRateStat">-</dd>
                </div>
                <div class="frame-only">
                  <dt>フレーム揃え後の合計</dt>
                  <dd id="frameAlignedTotal">-</dd>
                </div>
                <div class="frame-only">
                  <dt>累積のずれ</dt>
                  <dd id="frameDrift">-</dd>
                </div>
              </dl>
            </div>
            <div>
              <h3>ログ</h3>
              <pre id="log" class="log"></pre>
            </div>
          </div>
        </section>

        <input type="hidden" name="mode" id="modeInput" value="manual" />
      </form>
    </main>

    <footer class="app-footer">
      <p>処理はすべてブラウザ内で完結します。選択したファイルが外部に送信されることはありません。</p>
    </footer>

    <div id="settingsPanel" class="settings-panel" aria-hidden="true">
      <div class="settings-panel__overlay" data-close-settings></div>
      <div class="settings-panel__content" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <header class="settings-panel__header">
          <div>
            <h2 id="settingsTitle">詳細設定</h2>
            <p class="hint">フォルダ選択やタイミング調整などの詳細をカスタマイズできます。</p>
          </div>
          <button id="closeSettingsButton" class="icon-button" type="button">
            <span class="sr-only">設定を閉じる</span>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6.7 6.7a1 1 0 0 1 1.4 0L12 10.6l3.9-3.9a1 1 0 1 1 1.4 1.4L13.4 12l3.9 3.9a1 1 0 0 1-1.4 1.4L12 13.4l-3.9 3.9a1 1 0 0 1-1.4-1.4l3.9-3.9-3.9-3.9a1 1 0 0 1 0-1.4Z" />
            </svg>
          </button>
        </header>

        <section class="settings-section">
          <h3>ファイルの読み込み</h3>
          <p class="hint">フォルダ単位か個別ファイル単位かを切り替えられます。</p>
          <div class="picker-toggle" id="pickerToggle" role="radiogroup" aria-label="読み込み対象の切り替え">
            <button type="button" class="picker-option active" data-picker-mode="folder" aria-pressed="true">フォルダ</button>
            <button type="button" class="picker-option" data-picker-mode="file" aria-pressed="false">ファイル</button>
          </div>
        </section>

        <section class="settings-section">
          <h3>タイミング調整モード</h3>
          <label class="toggle">
            <input type="checkbox" id="autoModeToggle" />
            <span>自動調整モードを使用する</span>
          </label>
          <div class="mode-settings" data-mode="manual">
            <label for="manualAdjustment">1クリップあたりの加算秒数</label>
            <input
              type="number"
              id="manualAdjustment"
              name="manualAdjustment"
              step="0.01"
              value="0"
              min="-5"
              max="5"
            />
            <p class="hint">例: 0.02 と指定すると、すべての字幕が0.02秒ずつ伸びます。</p>
          </div>

          <div class="mode-settings hidden" data-mode="auto">
            <label for="targetTotalTime">目標の合計時間（秒）</label>
            <input
              type="number"
              id="targetTotalTime"
              name="targetTotalTime"
              step="0.1"
              min="0"
              value="60"
              required
            />
            <p class="hint">選択した音声の合計時間に合わせて、均等に微調整します。</p>
          </div>
        </section>

        <section class="settings-section">
          <h3>フレーム揃え</h3>
          <label class="checkbox">
            <input type="checkbox" id="enableFrameLock" name="enableFrameLock" checked />
            <span>フレーム境界に合わせてタイムコードを丸める</span>
          </label>
          <label class="checkbox">
            <input type="checkbox" id="trimFrameOverflow" name="trimFrameOverflow" checked />
            <span>フレームからはみ出した余剰時間を切り捨てる</span>
          </label>
        </section>

        <section class="settings-section">
          <h3>テーマ</h3>
          <label class="toggle">
            <input type="checkbox" id="themeToggle" />
            <span>ダークモード</span>
          </label>
        </section>
      </div>
    </div>

    <script src="app.js" type="module"></script>
  </body>
</html>
