<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Voievox SRT ジェネレーターは、音声と台本テキストのセットからフレームに揃った字幕ファイルをブラウザ上で生成できる無料ツールです。"
    />
    <title>Voievox SRT ジェネレーター</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>SRT字幕自動生成ツール</h1>
      <p class="lead">
        音声（.wav）とテキスト（.txt）のペアから、フレームに揃ったSRT字幕を生成します。
      </p>
    </header>

    <main class="app-main">
      <section class="card step-card" id="uploadStep">
        <div class="step-heading">
          <p class="step-label">STEP 1</p>
          <h2>ファイルを読み込む</h2>
          <p class="hint">
            フォルダごとでもファイルでも選択できます。ドラッグ＆ドロップにも対応しています。
          </p>
        </div>

        <div
          id="dropzone"
          class="dropzone"
          role="button"
          tabindex="0"
          aria-label="ファイルまたはフォルダをドラッグ＆ドロップ、または選択"
        >
          <div class="drop-inner">
            <p class="drop-title">ここにファイル/フォルダをドロップ</p>
            <p class="muted">同名の .wav と .txt をセットで読み込みます。</p>
            <div class="drop-actions">
              <button type="button" id="selectFilesButton" class="button button-primary">
                ファイルを選択
              </button>
              <button type="button" id="selectFolderButton" class="button button-secondary">
                フォルダを選択
              </button>
            </div>
            <p class="hint">選択したデータはブラウザ内でのみ処理され、アップロードされません。</p>
          </div>
        </div>

        <input id="fileInput" type="file" multiple accept=".wav,.txt" hidden />
        <input id="folderInput" type="file" webkitdirectory directory multiple hidden />

        <div id="selectedFiles" class="selected-files empty" aria-live="polite">
          ファイルが選択されていません
        </div>
      </section>

      <section class="card step-card" id="settingsStep" hidden>
        <div class="step-heading">
          <p class="step-label">STEP 2</p>
          <h2>動画設定</h2>
          <p class="hint">
            動画編集ソフトで設定しているフレームレートを選択（または入力）してください。
          </p>
        </div>

        <form id="settingsForm" class="settings-form">
          <input type="hidden" name="mode" id="modeInput" value="manual" />

          <fieldset class="highlight">
            <legend>フレームレート</legend>
            <p class="hint">プリセットをクリックするか、任意の値を入力できます。</p>
            <div
              class="frame-rate-presets"
              id="frameRatePresets"
              role="radiogroup"
              aria-label="フレームレートプリセット"
            >
              <button type="button" class="frame-rate-chip" data-frame-rate="23.976">23.976</button>
              <button type="button" class="frame-rate-chip" data-frame-rate="24">24</button>
              <button type="button" class="frame-rate-chip active" data-frame-rate="30">30</button>
              <button type="button" class="frame-rate-chip" data-frame-rate="60">60</button>
              <button type="button" class="frame-rate-chip" data-frame-rate="custom">カスタム</button>
            </div>
            <label for="frameRate">使用するフレームレート (fps)</label>
            <input
              type="number"
              id="frameRate"
              name="frameRate"
              step="0.001"
              min="1"
              max="240"
              value="30"
            />
            <label class="checkbox">
              <input type="checkbox" id="enableFrameLock" name="enableFrameLock" checked />
              <span>フレーム境界に合わせてタイムコードを丸める（推奨）</span>
            </label>
            <label class="checkbox nested">
              <input type="checkbox" id="trimFrameOverflow" name="trimFrameOverflow" checked />
              <span>フレームからはみ出した余剰時間を切り捨てる</span>
            </label>
          </fieldset>

          <details class="advanced" id="advancedSettings">
            <summary>その他の設定（必要なときだけ開いてください）</summary>
            <div class="advanced-body">
              <fieldset>
                <legend>タイミング調整</legend>
                <label class="toggle">
                  <input type="checkbox" id="autoModeToggle" />
                  <span>合計時間に合わせて自動調整する</span>
                </label>
                <div class="mode-settings" data-mode="manual">
                  <label for="manualAdjustment">1クリップあたりの加算秒数</label>
                  <input
                    type="number"
                    id="manualAdjustment"
                    name="manualAdjustment"
                    step="0.01"
                    value="0"
                    min="-5"
                    max="5"
                  />
                  <p class="hint">例: 0.02 と指定すると、すべての字幕が0.02秒ずつ伸びます。</p>
                </div>

                <div class="mode-settings hidden" data-mode="auto">
                  <label for="targetTotalTime">目標の合計時間（秒）</label>
                  <input
                    type="number"
                    id="targetTotalTime"
                    name="targetTotalTime"
                    step="0.1"
                    min="0"
                    value="60"
                    required
                  />
                  <p class="hint">選択した音声の合計時間に合わせて、均等に微調整します。</p>
                </div>
              </fieldset>
            </div>
          </details>

          <div class="action-row">
            <button type="submit" class="button button-primary">SRTを生成</button>
            <button type="button" id="jumpToUpload" class="button button-ghost">ファイル選択に戻る</button>
          </div>
        </form>
      </section>

      <section class="card step-card" id="results" hidden>
        <div class="step-heading">
          <p class="step-label">STEP 3</p>
          <h2>結果</h2>
          <p class="hint">ダウンロードして動画編集ソフトに取り込んでください。</p>
        </div>

        <div class="result-actions">
          <a id="downloadLink" class="button button-primary" download="output.srt">SRTファイルをダウンロード</a>
          <div class="result-secondary">
            <button type="button" id="reuploadFilesButton" class="button button-secondary">
              新しいファイル・フォルダを指定
            </button>
            <button type="button" id="regenerateButton" class="button button-ghost">
              設定を調整して再生成
            </button>
          </div>
        </div>

        <div class="result-grid">
          <div>
            <h3>統計</h3>
            <dl class="stats">
              <div>
                <dt>クリップ数</dt>
                <dd id="clipCount">0</dd>
              </div>
              <div>
                <dt>元の合計時間</dt>
                <dd id="originalTotal">0.00 秒</dd>
              </div>
              <div>
                <dt>適用調整値</dt>
                <dd id="adjustment">0.0000 秒</dd>
              </div>
              <div class="auto-only">
                <dt>目標合計時間</dt>
                <dd id="targetTotal">-</dd>
              </div>
              <div class="frame-only">
                <dt>使用フレームレート</dt>
                <dd id="frameRateStat">-</dd>
              </div>
              <div class="frame-only">
                <dt>フレーム揃え後の合計</dt>
                <dd id="frameAlignedTotal">-</dd>
              </div>
              <div class="frame-only">
                <dt>累積のずれ</dt>
                <dd id="frameDrift">-</dd>
              </div>
            </dl>
          </div>
          <div>
            <h3>ログ</h3>
            <pre id="log" class="log"></pre>
          </div>
        </div>
      </section>

      <section class="card guide-card" id="howto">
        <div class="guide-heading">
          <p class="step-label">GUIDE</p>
          <h2>使い方と活用のヒント</h2>
          <p class="hint">
            Google AdSense 審査でもコンテンツとして評価されるよう、ツールの目的や手順を詳しくまとめました。ブラウザ内完結で個人情報はアップロードされません。
          </p>
        </div>

        <div class="guide-grid">
          <article>
            <h3>基本の流れ</h3>
            <ol class="guide-steps">
              <li>
                <strong>素材を準備:</strong> 1 つの発話ごとに <code>.wav</code> と <code>.txt</code> を同名で揃え、フォルダにまとめます。
              </li>
              <li>
                <strong>STEP 1 で読み込み:</strong> ドラッグ＆ドロップまたはボタンからフォルダ/ファイルを選択します。ファイル名は自動で昇順に並びます。
              </li>
              <li>
                <strong>STEP 2 で設定:</strong> 動画編集ソフトに合わせてフレームレートを指定し、必要に応じて自動調整やフレーム揃えを有効にします。
              </li>
              <li>
                <strong>STEP 3 でダウンロード:</strong> 生成された SRT を保存し、Premiere Pro / DaVinci Resolve / CapCut などに読み込んで利用します。
              </li>
            </ol>
          </article>

          <article>
            <h3>設定のコツ</h3>
            <ul class="guide-list">
              <li>
                <strong>フレーム境界への丸め:</strong> チェックを入れるとタイムコードがピッタリのフレームに揃い、映像と字幕のずれを防げます。
              </li>
              <li>
                <strong>自動調整モード:</strong> 目標合計時間を指定すると、各クリップに均等な微調整を加えて尺合わせが行えます。
              </li>
              <li>
                <strong>手動オフセット:</strong> 台本の読み上げが全体的に早い/遅いと感じたら、加算秒数をプラスまたはマイナスで入力してください。
              </li>
              <li>
                <strong>テキスト整形:</strong> SRT は改行を保持します。句読点や改行位置を整えると、視認性の高い字幕になります。
              </li>
            </ul>
          </article>

          <article>
            <h3>よくある質問</h3>
            <dl class="faq">
              <div>
                <dt>Q. 処理したファイルはサーバーに送信されますか？</dt>
                <dd>A. すべてブラウザ内で完結し、アップロードされません。オフラインに近い感覚で安心してご利用いただけます。</dd>
              </div>
              <div>
                <dt>Q. どの音声形式に対応していますか？</dt>
                <dd>A. 現状は <code>.wav</code> に対応しています。別形式は音声編集ソフトや FFmpeg で変換してからご利用ください。</dd>
              </div>
              <div>
                <dt>Q. 文字化けが発生する場合は？</dt>
                <dd>A. テキストファイルを UTF-8 で保存してください。エディタで再保存すると解消するケースが多いです。</dd>
              </div>
              <div>
                <dt>Q. SRT をどこで検証できますか？</dt>
                <dd>A. VLC などのプレイヤーで再生して位置を確認するほか、YouTube に非公開アップロードして字幕を読み込むと仕上がりを素早く確認できます。</dd>
              </div>
            </dl>
          </article>
        </div>

        <section class="guide-note">
          <h3>活用シナリオ</h3>
          <p>
            ナレーションの差し替えや、マルチリンガル対応のための字幕量産、ポッドキャストの動画化など、音声とテキストが揃っている制作フローに最適です。無料で利用でき、広告掲載ポリシーに沿った健全な用途を想定しています。
          </p>
        </section>
      </section>
    </main>

    <footer class="app-footer">
      <p>
        同名の <code>.wav</code> と <code>.txt</code> ファイルをペアにして処理します。ファイル名は自動的に昇順で並び替えられます。
      </p>
      <p>
        本ツールで生成した字幕は、映像編集や配信プラットフォームで自由に利用できます。クリーンで実用的な技術解説コンテンツとして、広告配信にも適した形を目指しています。
      </p>
    </footer>

    <script src="app.js" type="module"></script>
  </body>
</html>
